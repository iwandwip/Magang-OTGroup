# PalletizerV1.3 System Data Flow Documentation
*Detailed Code-Level Communication Analysis*

## System Overview with ASCII Art

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PALLETIZER V1.3 SYSTEM ARCHITECTURE                   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    RS485     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    AltSoft  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 â”‚   9600bps    â”‚                 â”‚    Serial   â”‚          â”‚  â”‚
â”‚  â”‚   CENTRAL       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   ARM CONTROL   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  DRIVER  â”‚  â”‚
â”‚  â”‚  STATE MACHINE  â”‚              â”‚   (ARM1/ARM2)   â”‚   9600bps   â”‚ (X,Y,Z,T,G) â”‚
â”‚  â”‚                 â”‚              â”‚                 â”‚             â”‚          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                                â”‚                                      â”‚
â”‚          â”‚ Sensors/DIP                    â”‚ Buttons/LEDs                        â”‚
â”‚          â–¼                                â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   â”‚ S1,S2,S3    â”‚                  â”‚ START/STOP  â”‚                              â”‚
â”‚   â”‚ ARM1,ARM2   â”‚                  â”‚ LEDs/Buzzer â”‚                              â”‚
â”‚   â”‚ DIP1,DIP2   â”‚                  â”‚             â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Layer 1: Central State Machine Data Flow

### Initial System Data
```
STARTUP DATA INITIALIZATION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. EEPROM Parameters (56 total)         â”‚
â”‚    â”Œâ”€ Global (14): x,y1,y2,z,t,g...    â”‚
â”‚    â”œâ”€ Positions (32): XO1-XO8,YO1-YO8..â”‚
â”‚    â””â”€ Offsets (10): xL,yL,zL,xR,yR,zR..â”‚
â”‚                                         â”‚
â”‚ 2. DIP Switch Reading                   â”‚
â”‚    â”Œâ”€ ARM1: D5,D6,D3,D4 â†’ start_layer  â”‚
â”‚    â””â”€ ARM2: A0,A1,A3,A2 â†’ start_layer  â”‚
â”‚                                         â”‚
â”‚ 3. ARM State Machine Init               â”‚
â”‚    â”Œâ”€ ARM1_SM: state=IDLE, pos=0       â”‚
â”‚    â””â”€ ARM2_SM: state=IDLE, pos=0       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Main Loop Data Flow
```
MAIN LOOP CYCLE (every ~10ms):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    30ms      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Read Sensors  â”‚â”€ interval â”€â”€â–ºâ”‚ sensor1_state = S1_PIN  â”‚   â”‚
â”‚  â”‚                 â”‚              â”‚ sensor2_state = S2_PIN  â”‚   â”‚
â”‚  â”‚                 â”‚              â”‚ sensor3_state = S3_PIN  â”‚   â”‚
â”‚  â”‚                 â”‚              â”‚ arm1_response = ARM1_PIN â”‚   â”‚
â”‚  â”‚                 â”‚              â”‚ arm2_response = ARM2_PIN â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                    â”‚                â”‚
â”‚           â–¼                                    â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Update ARM1_SM  â”‚              â”‚ Update ARM2_SM          â”‚   â”‚
â”‚  â”‚ State Machine   â”‚              â”‚ State Machine           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                    â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                          â–¼                                      â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                â”‚ System Logic    â”‚                              â”‚
â”‚                â”‚ handleSystemLogicStateMachine()                â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                â”‚ Command         â”‚                              â”‚
â”‚                â”‚ Generation &    â”‚                              â”‚
â”‚                â”‚ RS485 Send      â”‚                              â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Command Generation Process - WITH CODE REFERENCES
```
DYNAMIC COMMAND GENERATION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”— CODE: PalletizerCentralStateMachine.ino                         â”‚
â”‚                                                                     â”‚
â”‚ Input: ARM_ID + command_index                                       â”‚
â”‚   â”‚                                                                 â”‚
â”‚   â–¼                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Calculate       â”‚  ğŸ“Line 1212 â”‚ commandPair = index / 2     â”‚    â”‚
â”‚ â”‚ Layer & Task    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ layer = commandPair / 8     â”‚    â”‚
â”‚ â”‚ generateCommand â”‚  ğŸ“Line 1213 â”‚ task = commandPair % 8      â”‚    â”‚
â”‚ â”‚ ()              â”‚  ğŸ“Line 1214 â”‚ isHome = (index % 2 == 0)   â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                 â”‚
â”‚   â–¼                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Select          â”‚  ğŸ“Line 1220 â”‚ if (armId == 1):            â”‚    â”‚
â”‚ â”‚ ARM Offset      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   xOffset = params.xL       â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line 1221 â”‚ else:                       â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚   xOffset = params.xR       â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                 â”‚
â”‚   â–¼                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚ â”‚ Generate        â”‚  ğŸ“Line 1239: sprintf(commandBuffer, "H(...)" â”‚
â”‚ â”‚ Command String  â”‚  ğŸ“Line 1261: sprintf(commandBuffer, "G(...)" â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  775: return "P"                       â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  777: return "C"                       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚   â”‚                                                                 â”‚
â”‚   â–¼                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Add ARM Prefix  â”‚  ğŸ“Line  828 â”‚ armPrefix = (arm_in_center  â”‚    â”‚
â”‚ â”‚ & Send RS485    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   == 1) ? "L" : "R";       â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  829 â”‚ fullCommand = armPrefix +   â”‚    â”‚
â”‚ â”‚ sendRS485Cmd... â”‚              â”‚   "#" + gladCommand;        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                 â”‚
â”‚   â–¼                                                                 â”‚
â”‚ ğŸ“Line 1320: sendRS485Command(command)                             â”‚
â”‚ ğŸ“Line 1326: uint8_t checksum = calculateXORChecksum(...)          â”‚
â”‚ ğŸ“Line 1327: String fullCommand = command + "*" + checksum         â”‚
â”‚ ğŸ“Line 1328: rs485.println(fullCommand);                           â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RS485 Communication: Central â†’ ARM Control
```
ğŸ“¡ TRANSMISSION PROCESS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”— FROM: PalletizerCentralStateMachine.ino                         â”‚
â”‚ ğŸ”— TO:   PalletizerArmControl.ino                                   â”‚
â”‚                                                                     â”‚
â”‚ SENDER SIDE (Central):                                              â”‚
â”‚ ğŸ“Line   42: SoftwareSerial rs485(RS485_RO, RS485_DI);             â”‚
â”‚ ğŸ“Line 1089: rs485.begin(9600);                                    â”‚
â”‚                                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Format Command  â”‚  ğŸ“Line 1327 â”‚ fullCommand = command +     â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   "*" + String(checksum,HEX)â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                 â”‚
â”‚   â–¼                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Transmit via    â”‚  ğŸ“Line 1328 â”‚ rs485.println(fullCommand); â”‚    â”‚
â”‚ â”‚ RS485           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ rs485.flush();              â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line 1329 â”‚ delay(50);                  â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â”‚ RECEIVER SIDE (ARM Control):                                        â”‚
â”‚ ğŸ“Line   76: SoftwareSerial rs485Serial(RS485_RX_PIN,RS485_TX_PIN);â”‚
â”‚ ğŸ“Line  259: rs485Serial.begin(SERIAL_BAUD_RATE);                  â”‚
â”‚                                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Receive Buffer  â”‚  ğŸ“Line  474 â”‚ if (rs485Serial.available())â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   while (rs485Serial.       â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  475 â”‚     available())             â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                 â”‚
â”‚   â–¼                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Parse Command   â”‚  ğŸ“Line  476 â”‚ char receivedChar =         â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   rs485Serial.read();       â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  478 â”‚ if (receivedChar == '\n')   â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  480 â”‚   processCommand(buffer);   â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Machine Transitions
```
ARM STATE MACHINE DATA FLOW:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                    â”‚
â”‚    ARM_IDLE                                                        â”‚
â”‚       â”‚                                                            â”‚
â”‚       â”‚ Condition: sensor3==HIGH && arm_in_center==0               â”‚
â”‚       â–¼                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ Generate HOME   â”‚           â”‚ Command: "L#H(x,y,z,t,g)"  â”‚       â”‚
â”‚ â”‚ Command         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Send via RS485              â”‚       â”‚
â”‚ â”‚                 â”‚           â”‚ arm_in_center = ARM_ID      â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚       â”‚                                                            â”‚
â”‚       â–¼                                                            â”‚
â”‚ ARM_MOVING_TO_CENTER                                               â”‚
â”‚       â”‚                                                            â”‚
â”‚       â”‚ Condition: !sensor3 && !arm.is_busy                       â”‚
â”‚       â–¼                                                            â”‚
â”‚ ARM_IN_CENTER                                                      â”‚
â”‚       â”‚                                                            â”‚
â”‚       â”‚ Condition: !sensor1 && !sensor2 && !sensor3               â”‚
â”‚       â–¼                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ Generate GLAD   â”‚           â”‚ Command: "L#G(...)"         â”‚       â”‚
â”‚ â”‚ Command         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Send via RS485              â”‚       â”‚
â”‚ â”‚                 â”‚           â”‚ turnOffConveyor()           â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚       â”‚                                                            â”‚
â”‚       â–¼                                                            â”‚
â”‚ ARM_PICKING                                                        â”‚
â”‚       â”‚                                                            â”‚
â”‚       â”‚ Condition: was_busy && now_not_busy                        â”‚
â”‚       â–¼                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚ â”‚ Check Complete  â”‚ â”€ Even Layer Complete â”€â”€â–º ARM_EXECUTING_SPECIAL â”‚
â”‚ â”‚ Position        â”‚ â”€ All Complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ARM_EXECUTING_SPECIAL â”‚
â”‚ â”‚                 â”‚ â”€ Continue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ARM_IDLE             â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Layer 2: ARM Control Data Flow

### Device Identification Process
```
DEVICE DETECTION ON STARTUP:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚ A5 = OUTPUT LOW (ground reference)      â”‚
â”‚ A4 = INPUT_PULLUP                       â”‚
â”‚   â”‚                                     â”‚
â”‚   â–¼                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚ â”‚ if (A4 == LOW): â”‚ â”€â”€â–º ARM2 detected   â”‚
â”‚ â”‚   isARM2 = true â”‚                     â”‚
â”‚ â”‚ else:           â”‚ â”€â”€â–º ARM1 detected   â”‚
â”‚ â”‚   isARM2 = falseâ”‚                     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚   â”‚                                     â”‚
â”‚   â–¼                                     â”‚
â”‚ Set devicePrefix:                       â”‚
â”‚   ARM1: prefix = "L"                    â”‚
â”‚   ARM2: prefix = "R"                    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RS485 Command Reception Flow
```
RS485 COMMAND PROCESSING:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                    â”‚
â”‚ RS485 Serial Input Buffer                                          â”‚
â”‚   â”‚                                                                â”‚
â”‚   â–¼                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Receive Chars   â”‚              â”‚ commandBuffer[64]           â”‚    â”‚
â”‚ â”‚ until \n or \r  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Build command string        â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚                             â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                â”‚
â”‚   â–¼                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Parse & Validateâ”‚              â”‚ Find '*' separator          â”‚    â”‚
â”‚ â”‚ CRC Checksum    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Extract command & checksum  â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ Validate XOR checksum       â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                â”‚
â”‚   â–¼                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Check Device    â”‚              â”‚ if (prefix == devicePrefix) â”‚    â”‚
â”‚ â”‚ Prefix Match    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Process command           â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ else: ignore                â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AltSoftSerial Communication: ARM Control â†’ Drivers
```
ğŸ“¡ MOTOR COMMAND TRANSMISSION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”— FROM: PalletizerArmControl.ino                                   â”‚
â”‚ ğŸ”— TO:   PalletizerArmDriver.ino (each axis)                        â”‚
â”‚                                                                     â”‚
â”‚ SENDER SIDE (ARM Control):                                          â”‚
â”‚ ğŸ“Line   75: AltSoftSerial motorSerial;                            â”‚
â”‚ ğŸ“Line  256: motorSerial.begin(SERIAL_BAUD_RATE);                  â”‚
â”‚                                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Build Command   â”‚  ğŸ“Line  992 â”‚ snprintf_P(command, sizeof  â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   (command), PSTR("X%d,Y%d â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  993 â”‚   ,T%d,G%d"), homeCmd.x,    â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚   homeCmd.y, homeCmd.t,...)  â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                 â”‚
â”‚   â–¼                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Add Checksum    â”‚  ğŸ“Line  585 â”‚ uint8_t checksum =          â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   calculateXORChecksum(...) â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  596 â”‚ motorSerial.print(checksum, â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚   HEX);                     â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                 â”‚
â”‚   â–¼                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Transmit        â”‚  ğŸ“Line  595 â”‚ motorSerial.print(command); â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ motorSerial.print("*");     â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  598 â”‚ motorSerial.println();      â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â”‚ RECEIVER SIDE (Driver):                                             â”‚
â”‚ ğŸ“Line   44: AltSoftSerial serialComm;                             â”‚
â”‚ ğŸ“Line  153: serialComm.begin(SERIAL_BAUD_RATE);                   â”‚
â”‚                                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Receive Buffer  â”‚  ğŸ“Line  251 â”‚ while (serialComm.          â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   available())               â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  252 â”‚   char receivedChar =        â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚     serialComm.read();       â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                 â”‚
â”‚   â–¼                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Parse & Filter  â”‚  ğŸ“Line  255 â”‚ if (receivedChar == '\n')   â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   validateAndExecuteCommand â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  258 â”‚     (commandBuffer);         â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Command Sequence Execution - WITH CODE REFERENCES
```
COMMAND SEQUENCE BREAKDOWN:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”— CODE: PalletizerArmControl.ino                                               â”‚
â”‚                                                                                 â”‚
â”‚ HOME COMMAND: "L#H(3870,390,3840,240,-30)"                                     â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Parse     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ parseHomeCommandâ”‚  ğŸ“Line  842 â”‚ sscanf(openParen + 1, "%d,%d,%d,%d,%d", â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   &homeCmd.x, &homeCmd.y, &homeCmd.z,  â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  843 â”‚   &homeCmd.t, &homeCmd.g);             â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ HOME Sequence   â”‚   Step 1     â”‚ ğŸ“Line  992: snprintf_P(command,       â”‚    â”‚
â”‚ â”‚ executeHomeStep â”‚  ğŸ“Line  989 â”‚   PSTR("X%d,Y%d,T%d,G%d"), homeCmd.x,  â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   homeCmd.y, homeCmd.t, homeCmd.g);    â”‚    â”‚
â”‚ â”‚                 â”‚   Step 2     â”‚ ğŸ“Line 1001: snprintf_P(command,       â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line 1000 â”‚   PSTR("Z%d"), homeCmd.z);             â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â”‚ GLAD COMMAND: "L#G(1620,2205,3975,240,60,270,750,3960,2340,240)"              â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ GLAD Sequence   â”‚   Step 1     â”‚ ğŸ“Line 1062: sendSafeMotorCommand      â”‚    â”‚
â”‚ â”‚ executeGladStep â”‚  ğŸ“Line 1059 â”‚   (PSTR("Z%d"), gladCmd.zb);           â”‚    â”‚
â”‚ â”‚ (8 steps total) â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Step 2: PSTR("G%d"), gladCmd.gp);      â”‚    â”‚
â”‚ â”‚                 â”‚   Step 3     â”‚ Step 3: PSTR("Z%d"), zn-za);           â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Step 4: PSTR("X%d,Y%d,T%d"), xn,yn,tn);â”‚    â”‚
â”‚ â”‚                 â”‚   ...        â”‚ Step 5: PSTR("Z%d"), gladCmd.zn);      â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ Step 6: PSTR("G%d"), gladCmd.dp);      â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ Step 7: PSTR("Z%d"), zn-za again);     â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ Step 8: PSTR("X%d,T%d"), xa,ta);       â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Driver Command Processing - WITH CODE REFERENCES  
```
DRIVER COMMAND FILTERING & EXECUTION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”— CODE: PalletizerArmDriver.ino                                                â”‚
â”‚                                                                                 â”‚
â”‚ INPUT: "X3870,Y390,T240,G-30*A3"                                               â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Validate CRC    â”‚  ğŸ“Line   75 â”‚ separatorIndex = receivedData.          â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   indexOf('*');                         â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line   97 â”‚ if (receivedChecksum ==                 â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚     calculatedChecksum)                 â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Split by Comma  â”‚  ğŸ“Line  276 â”‚ int startIndex = 0;                     â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ commaIndex = command.indexOf(',',       â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  281 â”‚   startIndex);                          â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ Parse each: "X3870", "Y390", etc.      â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Filter by       â”‚  ğŸ“Line  300 â”‚ char targetDriverID =                   â”‚    â”‚
â”‚ â”‚ Driver ID       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   singleCommand.charAt(0);              â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  308 â”‚ if (targetDriverID == driverID) {       â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚   // Process this command               â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Execute Motor   â”‚  ğŸ“Line  312 â”‚ long targetPosition =                   â”‚    â”‚
â”‚ â”‚ Movement        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   singleCommand.substring(1).toInt();  â”‚    â”‚
â”‚ â”‚                 â”‚  ğŸ“Line  317 â”‚ if (targetPosition == 0)                â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚   performHoming();                      â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ else moveToPosition(targetPosition);    â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Machine Data Flow
```
ARM CONTROL STATE TRANSITIONS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                 â”‚
â”‚ STATE_ZEROING                                                                   â”‚
â”‚   â”‚ Data: isParkSequenceActive=true, parkSequenceStep=1                        â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ PARK Sequence   â”‚   Step 1     â”‚ Send: "Z0*checksum" + 2s delay          â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Step 2: "X0,T0,G0*checksum" + 2s delay â”‚    â”‚
â”‚ â”‚                 â”‚   Step 3     â”‚ Send: "Y0*checksum"                     â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚ When complete: isMotorReady() == true                                       â”‚
â”‚   â–¼                                                                             â”‚
â”‚ STATE_SLEEPING                                                                  â”‚
â”‚   â”‚ Data: RED LED ON, USB commands enabled                                     â”‚
â”‚   â”‚ Condition: isStartButtonPressed() (4-second hold)                          â”‚
â”‚   â–¼                                                                             â”‚
â”‚ STATE_READY                                                                     â”‚
â”‚   â”‚ Data: RED+YELLOW LEDs, COMMAND_ACTIVE_PIN = LOW                            â”‚
â”‚   â”‚ Accepts: HOME commands from RS485                                          â”‚
â”‚   â–¼                                                                             â”‚
â”‚ STATE_RUNNING                                                                   â”‚
â”‚   â”‚ Data: GREEN LED, processes GLAD commands                                   â”‚
â”‚   â”‚ Exit: STOP button (4-second hold) or sequence complete                     â”‚
â”‚   â–¼                                                                             â”‚
â”‚ Back to STATE_ZEROING                                                           â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Layer 3: Driver Data Flow

### Hardware Configuration Detection
```
DRIVER INITIALIZATION DATA:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚ Strap Pin Reading (D3,D4,D5):           â”‚
â”‚   â”‚                                     â”‚
â”‚   â–¼                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚ â”‚ strapCode =     â”‚  0b111 â”€â”€â–º X-axis   â”‚
â”‚ â”‚ (D5<<2) |       â”‚  0b110 â”€â”€â–º Y-axis   â”‚
â”‚ â”‚ (D4<<1) |       â”‚  0b101 â”€â”€â–º Z-axis   â”‚
â”‚ â”‚ (D3<<0)         â”‚  0b100 â”€â”€â–º G-axis   â”‚
â”‚ â”‚                 â”‚  0b011 â”€â”€â–º T-axis   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚   â”‚                                     â”‚
â”‚   â–¼                                     â”‚
â”‚ Speed Selection (A1-A2):                â”‚
â”‚   if (A1 connected to A2):              â”‚
â”‚     MOVE_MAX_SPEED = full_speed         â”‚
â”‚   else:                                 â”‚
â”‚     MOVE_MAX_SPEED = 0.5 * full_speed   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Motor Speed Configuration by Axis
```
AXIS-SPECIFIC SPEED CONFIGURATION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                â”‚
â”‚ X-AXIS: MOVE_MAX_SPEED=2600, MOVE_HOME_SPEED=300, TOLERANCE=3                 â”‚
â”‚ Y-AXIS: MOVE_MAX_SPEED=4000, MOVE_HOME_SPEED=300, TOLERANCE=10                â”‚
â”‚ Z-AXIS: MOVE_MAX_SPEED=4000, MOVE_HOME_SPEED=300, TOLERANCE=0                 â”‚
â”‚ T-AXIS: MOVE_MAX_SPEED=5000, MOVE_HOME_SPEED=4000, TOLERANCE=100              â”‚
â”‚ G-AXIS: MOVE_MAX_SPEED=4000, MOVE_HOME_SPEED=150, TOLERANCE=10                â”‚
â”‚                                                                                â”‚
â”‚ AccelStepper Configuration:                                                    â”‚
â”‚   stepperMotor.setMaxSpeed(speed)                                             â”‚
â”‚   stepperMotor.setAcceleration(speed * 0.5)                                  â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Command Processing Flow
```
DRIVER COMMAND PROCESSING:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                 â”‚
â”‚ AltSoftSerial Input: "X3870,Y390,T240,G-30*A3"                                 â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Parse Command   â”‚              â”‚ Find '*' separator                      â”‚    â”‚
â”‚ â”‚ & Validate CRC  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ command = "X3870,Y390,T240,G-30"       â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ checksum = "A3"                         â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ Validate XOR checksum                   â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Split by Comma  â”‚              â”‚ "X3870" â†’ targetDriverID='X', pos=3870 â”‚    â”‚
â”‚ â”‚ & Filter by ID  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ "Y390"  â†’ targetDriverID='Y', pos=390  â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ "T240"  â†’ targetDriverID='T', pos=240  â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ "G-30"  â†’ targetDriverID='G', pos=-30  â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Execute if      â”‚              â”‚ if (targetDriverID == myDriverID):     â”‚    â”‚
â”‚ â”‚ ID Matches      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   if (pos == 0): performHoming()       â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚   else: moveToPosition(pos)             â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Motor Movement Execution
```
MOTOR MOVEMENT DATA FLOW:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                 â”‚
â”‚ NORMAL MOVEMENT: moveToPosition(3870)                                          â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Set Parameters  â”‚              â”‚ stepperMotor.setMaxSpeed(MOVE_MAX_SPEED)â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ stepperMotor.setAcceleration(MOVE_ACCEL)â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚ stepperMotor.moveTo(3870)               â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Execute Move    â”‚              â”‚ while(distanceToGo() != 0):             â”‚    â”‚
â”‚ â”‚ with Monitoring â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   stepperMotor.run()                    â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚   if(distanceToGo() <= TOLERANCE):      â”‚    â”‚
â”‚ â”‚                 â”‚              â”‚     setStatusLED(true)                  â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â”‚ HOMING MOVEMENT: performHoming()                                               â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Homing Sequence â”‚   Step 1     â”‚ if(isAtHomePosition()): moveAwayFromHomeâ”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Step 2: returnToHome()                  â”‚    â”‚
â”‚ â”‚                 â”‚   Step 3     â”‚ Step 3: setCurrentPosition(0)           â”‚    â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Step 4: moveTo(0)                      â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Status Feedback Flow - WITH CODE REFERENCES
```
ğŸ“¡ STATUS FEEDBACK CHAIN:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”— DRIVER â†’ ARM CONTROL â†’ CENTRAL                                               â”‚
â”‚                                                                                 â”‚
â”‚ DRIVER STATUS (PalletizerArmDriver.ino):                                       â”‚
â”‚ ğŸ“Line  425: setStatusLED(bool state)                                          â”‚
â”‚ ğŸ“Line  429: digitalWrite(LED_STATUS_PIN, LOW);  // Busy                       â”‚
â”‚ ğŸ“Line  436: digitalWrite(LED_STATUS_PIN, HIGH); // Ready                      â”‚
â”‚                                                                                 â”‚
â”‚ ARM CONTROL STATUS (PalletizerArmControl.ino):                                 â”‚
â”‚ ğŸ“Line   26: const int MOTOR_DONE_PIN = 3;       // Input dari drivers        â”‚
â”‚ ğŸ“Line   18: const int COMMAND_ACTIVE_PIN = 13;  // Output ke central         â”‚
â”‚                                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Read Motor      â”‚  ğŸ“Line  774 â”‚ bool reading1 =                         â”‚    â”‚
â”‚ â”‚ Status          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   digitalRead(MOTOR_DONE_PIN);          â”‚    â”‚
â”‚ â”‚ (PalletizerArm  â”‚  ğŸ“Line  767 â”‚ return lastMotorState == HIGH;          â”‚    â”‚
â”‚ â”‚ Control.ino)    â”‚              â”‚ // HIGH = ready, LOW = busy              â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Set Command     â”‚  ğŸ“Line  419 â”‚ digitalWrite(COMMAND_ACTIVE_PIN, HIGH); â”‚    â”‚
â”‚ â”‚ Active Status   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ // HIGH = busy/zeroing                  â”‚    â”‚
â”‚ â”‚ (PalletizerArm  â”‚  ğŸ“Line  446 â”‚ digitalWrite(COMMAND_ACTIVE_PIN, LOW);  â”‚    â”‚
â”‚ â”‚ Control.ino)    â”‚              â”‚ // LOW = ready/running                  â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â”‚ CENTRAL STATUS READ (PalletizerCentralStateMachine.ino):                       â”‚
â”‚ ğŸ“Line   10: const int ARM1_PIN = 7;      // Input dari ARM1 control          â”‚
â”‚ ğŸ“Line   11: const int ARM2_PIN = 8;      // Input dari ARM2 control          â”‚
â”‚                                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Read ARM        â”‚  ğŸ“Line 1281 â”‚ arm1_response =                         â”‚    â”‚
â”‚ â”‚ Status          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   digitalRead(ARM1_PIN);                â”‚    â”‚
â”‚ â”‚ (PalletizerCen  â”‚  ğŸ“Line 1282 â”‚ arm2_response =                         â”‚    â”‚
â”‚ â”‚ tralStateMach.. â”‚              â”‚   digitalRead(ARM2_PIN);                â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚                                                                             â”‚
â”‚   â–¼                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Update State    â”‚  ğŸ“Line 1284 â”‚ arm1_sm.is_busy = arm1_response;        â”‚    â”‚
â”‚ â”‚ Machine         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ arm2_sm.is_busy = arm2_response;        â”‚    â”‚
â”‚ â”‚ (PalletizerCen  â”‚  ğŸ“Line  641 â”‚ bool hardware_busy = digitalRead(...)   â”‚    â”‚
â”‚ â”‚ tralStateMach.. â”‚              â”‚ // Used in state transitions            â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## System Integration Data Flow Summary - WITH FILE REFERENCES

```
COMPLETE SYSTEM DATA FLOW SUMMARY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                 â”‚
â”‚ 1. ğŸ”— PalletizerCentralStateMachine.ino reads sensors â†’ generates commands     â”‚
â”‚    ğŸ“Line 1274-1282: readSensors() â†’ sensor1_state, sensor2_state, sensor3     â”‚
â”‚    ğŸ“Line 1210: generateCommand() â†’ "L#H(x,y,z,t,g)*checksum"                  â”‚
â”‚    ğŸ“Line 1328: rs485.println(fullCommand); â†’ sends via RS485                  â”‚
â”‚                                                                                 â”‚
â”‚ 2. ğŸ”— PalletizerArmControl.ino receives â†’ validates â†’ parses â†’ breaks down     â”‚
â”‚    ğŸ“Line 474-488: rs485Serial.available() â†’ processCommand()                  â”‚
â”‚    ğŸ“Line 500-508: parseAndValidateMessage() â†’ CRC validation                  â”‚
â”‚    ğŸ“Line 842: sscanf() parse HOME â†’ 992: snprintf_P() build motor cmd         â”‚
â”‚    ğŸ“Line 595-598: motorSerial.print() â†’ "X3870,Y390,T240,G-30*checksum"      â”‚
â”‚                                                                                 â”‚
â”‚ 3. ğŸ”— PalletizerArmDriver.ino receive â†’ filter by ID â†’ execute movements      â”‚
â”‚    ğŸ“Line 251-265: serialComm.available() â†’ commandBuffer                     â”‚
â”‚    ğŸ“Line 97: CRC validation â†’ executeCommand()                               â”‚  
â”‚    ğŸ“Line 300-308: if (targetDriverID == driverID) â†’ process command          â”‚
â”‚    ğŸ“Line 317-322: if (pos==0) performHoming() else moveToPosition()          â”‚
â”‚                                                                                 â”‚
â”‚ 4. ğŸ”— STATUS flows back: DRIVERâ†’ARM CONTROLâ†’CENTRAL via hardware pins         â”‚
â”‚    ğŸ“Driver Line 429/436: LED_STATUS_PIN (HIGH=ready, LOW=busy)               â”‚
â”‚    ğŸ“ARM Control Line 774: digitalRead(MOTOR_DONE_PIN)                        â”‚
â”‚    ğŸ“ARM Control Line 419/446: digitalWrite(COMMAND_ACTIVE_PIN)               â”‚ 
â”‚    ğŸ“Central Line 1281-1282: digitalRead(ARM1_PIN/ARM2_PIN)                   â”‚
â”‚                                                                                 â”‚
â”‚ 5. ğŸ”— PalletizerCentralStateMachine.ino monitors â†’ updates â†’ next commands    â”‚
â”‚    ğŸ“Line 1151-1152: updateArmStateMachine() â†’ state transitions              â”‚
â”‚    ğŸ“Line 1160: handleSystemLogicStateMachine() â†’ trigger next cycle          â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Critical Communication Failure Points - WITH EXACT CODE LOCATIONS

### ğŸš¨ **HIGH PROBABILITY FAILURE POINTS:**

```
FAILURE ANALYSIS WITH CODE REFERENCES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                 â”‚
â”‚ 1. ğŸ”¥ COMMAND ROUTING BUG (Central):                                           â”‚
â”‚    ğŸ“Line 511-512: const char* devicePrefix = isARM2_device ? "R" : "L";      â”‚  
â”‚    âŒ PROBLEM: isARM2_device undefined in Central â†’ always "L"                â”‚
â”‚    ğŸ’¥ IMPACT: ARM2 commands never processed                                   â”‚
â”‚                                                                                 â”‚
â”‚ 2. ğŸ”¥ DEVICE DETECTION BUG (ARM Control):                                     â”‚
â”‚    ğŸ“Line 249-251: return digitalRead(A4) == LOW;                             â”‚
â”‚    âŒ PROBLEM: A4 with INPUT_PULLUP = always HIGH when not connected          â”‚
â”‚    ğŸ’¥ IMPACT: ARM1/ARM2 detection fails â†’ wrong command filtering             â”‚
â”‚                                                                                 â”‚
â”‚ 3. ğŸ”¥ BLOCKING DELAYS (ARM Control):                                          â”‚
â”‚    ğŸ“Line 644,648,775,777: delay(10); delay(20);                              â”‚
â”‚    âŒ PROBLEM: Total 60ms+ blocking delays per loop cycle                     â”‚
â”‚    ğŸ’¥ IMPACT: Missed RS485 communication, timing failures                     â”‚
â”‚                                                                                 â”‚
â”‚ 4. ğŸ”¥ COMMAND PROCESSING (ARM Control):                                       â”‚
â”‚    ğŸ“Line 510-520: if (strncmp(command, devicePrefix, 1) == 0)                â”‚
â”‚    âŒ PROBLEM: Using 'command' instead of 'cleanCommand'                      â”‚
â”‚    ğŸ’¥ IMPACT: Commands with CRC suffix not matched properly                   â”‚
â”‚                                                                                 â”‚
â”‚ 5. ğŸ”¥ MEMORY CORRUPTION (Driver):                                             â”‚
â”‚    ğŸ“Line 49: String commandBuffer = "";                                      â”‚
â”‚    âŒ PROBLEM: Arduino String class dynamic allocation                        â”‚
â”‚    ğŸ’¥ IMPACT: Memory fragmentation â†’ system crashes                           â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Critical Data Dependencies

1. **EEPROM Parameters**: Must be valid for command generation
2. **DIP Switch Settings**: Determines ARM start positions  
3. **Hardware Pin States**: Critical for state machine transitions
4. **Checksum Validation**: All inter-layer communication depends on this
5. **Device ID Detection**: ARM1/ARM2 and X/Y/Z/T/G identification must work
6. **Timing Synchronization**: State machines depend on precise timing
